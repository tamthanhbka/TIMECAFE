Ngay	MaCLV	MaNV
1	QL02	QL1
1	T01	NV01
1	T01	NV03
1	T02	NV05
1	T02	NV07
2	QL01	QL2
2	T01	NV09
2	T03	NV02
2	T02	NV01
2	T05	NV04
3	QL01	QL1
3	T01	NV03
3	T03	NV06
3	T02	NV05
3	T04	NV08
4	QL01	QL2
4	T01	NV07
4	T04	NV10
4	T02	NV09
4	T05	NV02
5	QL01	QL1
5	T01	NV09
5	T03	NV04
5	T02	NV07
5	T04	NV06
6	QL01	QL2
6	T01	NV03
6	T03	NV08
6	T02	NV05
6	T04	NV10
7	QL02	QL1
7	T01	NV01
7	T01	NV07
7	T02	NV03
7	T02	NV09
8	QL02	QL2
8	T01	NV05
8	T01	NV03
8	T02	NV01
8	T02	NV07
9	QL01	QL1
9	T01	NV03
9	T03	NV06
9	T02	NV05
9	T04	NV08
10	QL01	QL2
10	T01	NV01
10	T03	NV10
10	T02	NV07
10	T05	NV04
11	QL01	QL1
11	T01	NV03
11	T04	NV02
11	T02	NV09
11	T05	NV04
12	QL01	QL2
12	T01	NV05
12	T03	NV08
12	T02	NV01
12	T04	NV10
13	QL01	QL1
13	T01	NV07
13	T03	NV06
13	T02	NV03
13	T05	NV02
14	QL02	QL2
14	T01	NV09
14	T01	NV05
14	T02	NV01
14	T02	NV03
15	QL02	QL1
15	T01	NV07
15	T01	NV09
15	T02	NV05
15	T02	NV03
16	QL01	QL2
16	T01	NV01
16	T03	NV06
16	T02	NV09
16	T04	NV04
17	QL01	QL1
17	T01	NV05
17	T03	NV02
17	T02	NV07
17	T05	NV08
18	QL01	QL2
18	T01	NV01
18	T04	NV10
18	T02	NV03
18	T05	NV02
19	QL01	QL1
19	T01	NV07
19	T03	NV04
19	T02	NV03
19	T04	NV06
20	QL01	QL2
20	T01	NV05
20	T04	NV08
20	T02	NV01
20	T05	NV02
21	QL02	QL1
21	T01	NV09
21	T01	NV07
21	T02	NV05
21	T02	NV03
22	QL02	QL2
22	T01	NV01
22	T01	NV03
22	T02	NV07
22	T02	NV09
23	QL01	QL1
23	T01	NV05
23	T04	NV04
23	T02	NV01
23	T05	NV08
24	QL03	QL2
24	T01	NV03
24	T02	NV05
24	T02	NV07
24	T02	NV09
25	QL01	QL1
25	T01	NV01
25	T03	NV10
25	T02	NV03
25	T04	NV02
26	QL01	QL2
26	T01	NV05
26	T03	NV04
26	T02	NV07
26	T05	NV06
27	QL01	QL1
27	T01	NV09
27	T04	NV08
27	T02	NV03
27	T05	NV10
28	QL02	QL2
28	T01	NV05
28	T01	NV01
28	T02	NV03
28	T02	NV09
29	QL02	QL1
29	T01	NV05
29	T01	NV07
29	T02	NV03
29	T02	NV01
30	QL01	QL2
30	T01	NV09
30	T03	NV02
30	T02	NV07
30	T05	NV06
31	QL03	QL1
31	T01	NV01
31	T02	NV03
31	T02	NV05
31	T02	NV09


delimiter $$
create function LuongTB(Ma_taixe varchar(10))
returns decimal(10,2)
deterministic
BEGIN
declare TongLuong int;
declare SoChuyen int;
declare TB decimal(10,2);
set TongLuong = (select sum(Luong*So_km) from Lo_trinh, Luong where Lo_trinh.Danh_gia = Luong.Danh_gia and id_taixe = Ma_taixe group by id_taixe);
set SoChuyen = (select count(id_lotrinh) from Lo_trinh where id_taixe = Ma_taixe group by id_taixe);
set TB = TongLuong/SoChuyen;
return TB;
end $$
delimiter ;
select Taixe.*, LuongTB(id_taixe) as "Luong Trung Binh" from Taixe where LuongTB(id_taixe) > avg(select sum(LuongTB(id_taixe)) from Taixe);
